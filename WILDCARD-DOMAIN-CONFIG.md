# æ³›åŸŸåä»£ç†é…ç½®è¯´æ˜

## âœ… é—®é¢˜å·²è§£å†³

**é—®é¢˜**: `https://a.qsgl.net` æ‰“å¼€æç¤ºæ‰¾ä¸åˆ°é¡µé¢ï¼Œæ²¡æœ‰ä»£ç†åˆ°åç«¯  
**åŸå› **: Envoyé…ç½®åªå…è®¸ `www.qsgl.net`ï¼Œä¸æ”¯æŒå…¶ä»–å­åŸŸå  
**è§£å†³**: å·²å°†é…ç½®æ”¹ä¸ºæ³›åŸŸå `*.qsgl.net` å’Œ `qsgl.net`

## å½“å‰é…ç½®

### æ”¯æŒçš„åŸŸå
Envoyç°åœ¨æ”¯æŒæ‰€æœ‰å­åŸŸåçš„ä»£ç†ï¼š

- âœ… `www.qsgl.net`
- âœ… `a.qsgl.net`
- âœ… `test.qsgl.net`
- âœ… `api.qsgl.net`
- âœ… ä»»ä½• `*.qsgl.net` å­åŸŸå
- âœ… è£¸åŸŸå `qsgl.net`

### é…ç½®è¯¦æƒ…
```yaml
# æ‰€æœ‰5ä¸ªç›‘å¬å™¨éƒ½å·²æ›´æ–°ä¸ºæ³›åŸŸå
virtual_hosts:
  - name: qsgl_backend
    domains: ["*.qsgl.net", "qsgl.net"]  # æ”¹ä¸ºæ³›åŸŸå
```

æ›´æ–°çš„ç›‘å¬å™¨ï¼š
1. âœ… `listener_https_443` (TCP 443ç«¯å£)
2. âœ… `listener_https_5002` (TCP 5002ç«¯å£)
3. âœ… `listener_https_99` (TCP 99ç«¯å£)
4. âœ… `listener_quic_443` (UDP 443ç«¯å£, HTTP/3)
5. âœ… `listener_quic_5002` (UDP 5002ç«¯å£, HTTP/3)

## æµ‹è¯•ç»“æœ

### a.qsgl.net æµ‹è¯•
```bash
$ curl -I https://a.qsgl.net/
HTTP/1.1 404 Not Found
content-length: 315
content-type: text/html; charset=us-ascii
server: envoy                    # âœ… è¯æ˜ç»è¿‡Envoyä»£ç†
date: Thu, 30 Oct 2025 00:32:16 GMT
x-envoy-upstream-service-time: 86
alt-svc: h3=":443"; ma=86400     # âœ… æ”¯æŒHTTP/3
```

**è¯´æ˜**: 
- âœ… ä»£ç†æ­£å¸¸å·¥ä½œï¼ˆçœ‹åˆ° `server: envoy`ï¼‰
- âœ… æ”¯æŒHTTP/3ï¼ˆçœ‹åˆ° `alt-svc` å¤´ï¼‰
- âš ï¸ è¿”å›404æ˜¯å› ä¸º**åç«¯æœåŠ¡å™¨**(61.163.200.245)ä¸Šæ²¡æœ‰é…ç½®`a.qsgl.net`ç«™ç‚¹

### www.qsgl.net æµ‹è¯•
```bash
$ curl -I https://www.qsgl.net/
HTTP/2 200
cache-control: no-cache
content-length: 29478
content-type: text/html
server: envoy                    # âœ… ç»è¿‡Envoy
alt-svc: h3=":443"; ma=86400    # âœ… æ”¯æŒHTTP/3
```

## DNSé…ç½®è¦æ±‚

### æ­£ç¡®é…ç½®ç¤ºä¾‹ï¼ˆæŒ‡å‘EnvoyæœåŠ¡å™¨ï¼‰
```
a.qsgl.net      A    62.234.212.241  âœ…
www.qsgl.net    A    62.234.212.241  âœ…
api.qsgl.net    A    62.234.212.241  âœ…
```

### é”™è¯¯é…ç½®ç¤ºä¾‹ï¼ˆç›´è¿åç«¯ï¼‰
```
test.qsgl.net   A    61.163.200.245  âŒ ç›´è¿åç«¯ï¼Œç»•è¿‡Envoy
```

**é‡è¦**: è¦ä½¿ç”¨Envoyä»£ç†ï¼Œæ‰€æœ‰å­åŸŸåå¿…é¡»é€šè¿‡DNSè§£æåˆ° `62.234.212.241`

## åç«¯æœåŠ¡å™¨é…ç½®

### å½“å‰åç«¯å“åº”
- âœ… `www.qsgl.net` â†’ 200 OK (æœ‰é…ç½®çš„ç«™ç‚¹)
- âŒ `a.qsgl.net` â†’ 404 Not Found (æœªé…ç½®)
- âŒ `test.qsgl.net` â†’ 404 Not Found (æœªé…ç½®)

### å¦‚ä½•åœ¨åç«¯æ·»åŠ æ–°ç«™ç‚¹

#### æ–¹æ³•1: IISç»‘å®šï¼ˆå¦‚æœåç«¯æ˜¯IISï¼‰
1. æ‰“å¼€IISç®¡ç†å™¨
2. é€‰æ‹©ç½‘ç«™
3. å³é”® â†’ ç¼–è¾‘ç»‘å®š
4. æ·»åŠ æ–°çš„ä¸»æœºåï¼š`a.qsgl.net`
5. ä¿å­˜å¹¶é‡å¯ç«™ç‚¹

#### æ–¹æ³•2: ä½¿ç”¨é€šé…ç¬¦ç»‘å®š
åœ¨IISæˆ–WebæœåŠ¡å™¨é…ç½®ä¸­ä½¿ç”¨ï¼š
```
*.qsgl.net  â†’  æŒ‡å‘åŒä¸€ç«™ç‚¹
```

è¿™æ ·æ‰€æœ‰å­åŸŸåéƒ½ä¼šè¢«åŒä¸€ç«™ç‚¹å¤„ç†ã€‚

#### æ–¹æ³•3: åº”ç”¨ç¨‹åºå†…è·¯ç”±
åœ¨ASP.NETæˆ–å…¶ä»–æ¡†æ¶ä¸­æ ¹æ® `Host` å¤´åˆ¤æ–­ï¼š
```csharp
if (Request.Host == "a.qsgl.net") {
    // å¤„ç† a.qsgl.net çš„è¯·æ±‚
}
```

## SSLè¯ä¹¦è¦†ç›–

å½“å‰Let's Encryptè¯ä¹¦å·²æ”¯æŒæ‰€æœ‰å­åŸŸåï¼š

```
è¯ä¹¦ä¸»é¢˜: CN = qsgl.net
SAN (ä¸»é¢˜å¤‡ç”¨åç§°):
  - DNS: *.qsgl.net  âœ… è¦†ç›–æ‰€æœ‰å­åŸŸå
  - DNS: qsgl.net    âœ… è¦†ç›–è£¸åŸŸå
```

è¯ä¹¦å¯¹ä»¥ä¸‹åŸŸåå‡æœ‰æ•ˆï¼š
- âœ… www.qsgl.net
- âœ… a.qsgl.net
- âœ… api.qsgl.net
- âœ… test.qsgl.net
- âœ… ä»»ä½• *.qsgl.net
- âœ… qsgl.net

## éªŒè¯å‘½ä»¤

### æµ‹è¯•ä»»æ„å­åŸŸåä»£ç†
```bash
# æµ‹è¯•a.qsgl.net
curl -I https://a.qsgl.net/

# æµ‹è¯•api.qsgl.net
curl -I https://api.qsgl.net/

# æŸ¥çœ‹æ˜¯å¦ç»è¿‡Envoyï¼ˆåº”è¯¥çœ‹åˆ° server: envoyï¼‰
curl -I https://å­åŸŸå.qsgl.net/ | grep -i server
```

### æœ¬åœ°æµ‹è¯•ï¼ˆä¸ä¾èµ–DNSï¼‰
```bash
# ç›´æ¥æµ‹è¯•EnvoyæœåŠ¡å™¨
curl -I -k -H "Host: a.qsgl.net" https://62.234.212.241/

# åº”è¯¥è¿”å›
# HTTP/2 404
# server: envoy  â† è¯´æ˜ä»£ç†å·¥ä½œæ­£å¸¸
```

### æ£€æŸ¥Envoyé…ç½®
```bash
ssh -i "C:\Key\qsgl_key.pem" ubuntu@62.234.212.241

# æŸ¥çœ‹å½“å‰åŸŸåé…ç½®
grep -A2 "domains:" /opt/envoy/config/envoy.yaml

# åº”è¯¥æ˜¾ç¤º:
# domains: ["*.qsgl.net", "qsgl.net"]
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: å­åŸŸåä»ç„¶æ˜¾ç¤º"æ‰¾ä¸åˆ°é¡µé¢"

**æ£€æŸ¥DNS**:
```bash
nslookup å­åŸŸå.qsgl.net
# å¿…é¡»è¿”å›: 62.234.212.241
```

**è§£å†³**: 
- å¦‚æœDNSæŒ‡å‘å…¶ä»–IPï¼Œéœ€è¦åœ¨DNSæœåŠ¡å•†å¤„ä¿®æ”¹Aè®°å½•
- æˆ–æ·»åŠ æ–°çš„Aè®°å½•æŒ‡å‘62.234.212.241

### é—®é¢˜2: æµè§ˆå™¨æ˜¾ç¤ºè¯ä¹¦è­¦å‘Š

**åŸå› **: æ³›åŸŸåè¯ä¹¦ `*.qsgl.net` è¦†ç›–æ‰€æœ‰å­åŸŸåï¼Œä¸åº”æœ‰è­¦å‘Š

**æ£€æŸ¥**:
```bash
openssl s_client -connect å­åŸŸå.qsgl.net:443 -servername å­åŸŸå.qsgl.net < /dev/null 2>/dev/null | openssl x509 -noout -text | grep DNS
```

åº”è¯¥æ˜¾ç¤º: `DNS:*.qsgl.net, DNS:qsgl.net`

**è§£å†³**:
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æ¸…é™¤DNSç¼“å­˜: `ipconfig /flushdns`

### é—®é¢˜3: åç«¯è¿”å›404

**è¿™ä¸æ˜¯Envoyçš„é—®é¢˜ï¼** 404è¡¨ç¤ºï¼š
- âœ… Envoyä»£ç†å·¥ä½œæ­£å¸¸
- âœ… è¯ä¹¦éªŒè¯é€šè¿‡
- âœ… è¯·æ±‚åˆ°è¾¾åç«¯æœåŠ¡å™¨
- âŒ åç«¯æœåŠ¡å™¨ä¸Šè¯¥åŸŸåæœªé…ç½®ç«™ç‚¹

**è§£å†³**: åœ¨åç«¯æœåŠ¡å™¨(61.163.200.245)ä¸Šé…ç½®è¯¥åŸŸåçš„ç«™ç‚¹ç»‘å®š

## ç›‘æ§å»ºè®®

### ç›‘æ§æ‰€æœ‰å­åŸŸå
å»ºè®®åœ¨ `monitor.py` ä¸­æ·»åŠ å¯¹ä¸»è¦å­åŸŸåçš„ç›‘æ§ï¼š

```python
urls_to_check = [
    "https://www.qsgl.net",
    "https://a.qsgl.net",
    "https://api.qsgl.net",
]
```

### æ—¥å¿—åˆ†æ
æŸ¥çœ‹å“ªäº›å­åŸŸåè¢«è®¿é—®ï¼š
```bash
sudo docker logs envoy-proxy | grep "path=\"/\"" | awk '{print $7}' | sort | uniq -c
```

## æ€§èƒ½è€ƒè™‘

æ³›åŸŸåé…ç½®ä¸ä¼šå½±å“æ€§èƒ½ï¼š
- âœ… åŸŸååŒ¹é…åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œé€Ÿåº¦æå¿«
- âœ… æ”¯æŒæˆåƒä¸Šä¸‡çš„å­åŸŸå
- âœ… ä¸éœ€è¦ä¸ºæ¯ä¸ªå­åŸŸåå•ç‹¬é…ç½®

## æ€»ç»“

âœ… **å·²å®Œæˆ**:
- Envoyé…ç½®å·²æ›´æ–°ä¸ºæ³›åŸŸå `*.qsgl.net`
- æ‰€æœ‰5ä¸ªç›‘å¬å™¨å‡æ”¯æŒæ³›åŸŸå
- `a.qsgl.net` å¯ä»¥æ­£å¸¸ä»£ç†åˆ°åç«¯
- Let's Encryptè¯ä¹¦è¦†ç›–æ‰€æœ‰å­åŸŸå

âš ï¸ **æ³¨æ„**:
- DNSå¿…é¡»æŒ‡å‘ `62.234.212.241` æ‰èƒ½ä½¿ç”¨ä»£ç†
- åç«¯æœåŠ¡å™¨éœ€è¦é…ç½®å¯¹åº”åŸŸåçš„ç«™ç‚¹æ‰èƒ½è¿”å›å†…å®¹
- è¿”å›404ä¸æ˜¯ä»£ç†é—®é¢˜ï¼Œæ˜¯åç«¯é…ç½®é—®é¢˜

ğŸ“ **åç»­æ­¥éª¤**:
1. åœ¨åç«¯æœåŠ¡å™¨ä¸Šé…ç½®éœ€è¦çš„å­åŸŸåç«™ç‚¹
2. æˆ–ä½¿ç”¨é€šé…ç¬¦ç»‘å®šè®©æ‰€æœ‰å­åŸŸåå…±äº«åŒä¸€ç«™ç‚¹
3. æ›´æ–°DNSè®°å½•ï¼Œå°†éœ€è¦ä»£ç†çš„å­åŸŸåæŒ‡å‘62.234.212.241
